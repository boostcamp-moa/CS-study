# Base64, Base64URL

Base64URL을 살펴보기 위해서는 Base64를 기본적으로 이해해야 한다.<br>

**Base64**란 8비트 이진 데이터를 문자 코드에 영향을 받지 않는 공통 ASCII 영역의 문자들로만 이루어진 일련의 문자열로 바꾸는 인코딩 방식을 가리키는 개념이다. 말이 어려운데, 예시를 통해 알아보자.

| 문자열     | M        | a        | n        |
| ---------- | -------- | -------- | -------- |
| 아스키코드 | 77       | 97       | 110      |
| 이진수     | 01001101 | 01100001 | 01101110 |

(1) "Man"이라는 문자열을 쓰면, 총 24개의 binary가 생긴다. 여기서 24비트를 6비트로 분할하자.

<br>

| 6비트 묶음 | 010011 | 010110 | 000101 | 101110 |
| ---------- | ------ | ------ | ------ | ------ |
| 십진수     | 19     | 21     | 5      | 46     |

(2) 24비트를 6비트로 분할하면, 총 4묶음이 나오는데 아래의 표 <Base64 색인표>를 참고하여 그에 걸맞는 문자를 도출하자.

![](https://i.imgur.com/V83OFAI.png)

<br>

| 6비트 묶음 | 010011 | 010110 | 000101 | 101110 |
| ---------- | ------ | ------ | ------ | ------ |
| 십진수     | 19     | 21     | 5      | 46     |
| base64     | T      | W      | F      | u      |

(3) 도출한 문자를 이어붙인 "TWFu"는 "Man"이라는 문자열을 base64 인코딩한 결과값이다. [여기](https://www.base64url.com/)서 테스트해볼 수 있다.

<br>

핵심은 아래의 순서를 그대로 따라해주면 된다는 것이다.

1. 평문에 있는 각 문자를 아스키 코드로 변환
2. 각 문자의 아스키코드를 이진수로 변환
3. 각 문자의 이진수를 이어붙인 후, 6개 단위로 분할
4. 6개 단위로 분할된 6bit의 이진수를 십진수로 변환
5. base64 색인표를 참고하여 4번에서 변환된 십진수에 알맞는 문자로 인코딩
6. 알맞게 인코딩된 각 문자를 이어붙이면, 그것이 평문을 base64 인코딩한 결과값

물론, 평문이 항상 세 글자 단위로 끊어지지 않는다는 문제점이 존재한다. 이러한 문제점을 해결하기 위해 padding이라는 의미없는 값을 넣게 되는데, base64 인코딩 방식에서는 `=`로 padding을 표현한다. 이것은 원본으로 되돌릴 때 원본에는 없던 비트가 생기는 것을 방지하기 위함이다.

> 예시

```
1. 평문: Many
2. 각 문자를 아스키코드로 변환: 77 97 110 121
3. 각 아스키코드를 이진수로 변환: 01001101 01100001 01101110 01111001
4. 아스키코드를 6개 단위로 분할: 010011 010110 000101 101110 011110 01
5. 남는 비트 뒤에는 0을 채워 6비트 만들기: 010011 010110 000101 101110 011110 010000
6. base64 인코딩된 값: TWFueQ==
```

여기서 문제는 또 있다. URL에서 이 **표준 Base64**를 사용하려면 62번의 `+`, 63번의 `/`, 패딩을 의미하는 `=` 문자를 특수 백분율 16진수 시퀀스로 인코딩해야 한다. 즉, `+`는 `%2B`가 되고 `/`는 `%2F`가 되며, `=`는 `%3D`가 된다. 그 이유는 URL에서 해당 문자를 특수한 기능을 하는 문자로 판단하기 때문이다.

위와 같은 이유로 인코딩된 문자열은 불필요하게 길어지는 문제가 발생한다. 그래서 URL을 위한 변형 변형한 Base64가 존재하며, 그것이 **Base64URL** 인코딩 방식이다. 

크게 어려울 건 없고 아래와 같은 내용이 바뀐다.

- 표준 Base64의 색인표에서 `+` 및 `/` 문자는 각각 `-`와 `_`로 대체
- URL을 위한 인코더/디코더 사용이 더 이상 필요하지 않음
- 인코딩된 값의 길이에 영향을 미치지 않음
- [RFC4648 - 'Base 64 Encoding with URL and Filename Safe Alphabet'](https://tools.ietf.org/html/rfc4648#section-5)을 참고했을 때, 패딩을 의미하던 `=`는 생략되는 것 같다 
  (이건 확실하지 않습니다... [여기](https://www.base64url.com/)서 확인해봤을 때는 사라집니다)

<br>

---

*레퍼런스*

1. [Base64 인코딩이란?](https://effectivesquid.tistory.com/entry/Base64-%EC%9D%B8%EC%BD%94%EB%94%A9%EC%9D%B4%EB%9E%80)

2. [base64 vs base64url safe 차이](https://babyprogram.tistory.com/50)

3. [위키백과 - 베이스64](https://ko.wikipedia.org/wiki/%EB%B2%A0%EC%9D%B4%EC%8A%A464)

