# 운영체제

## IPC (Inter Process Communication)

- 프로세스는 독립적으로 실행된다. 즉, 독립되어있다는 것은 다른 프로세스에게 영향을 받지 않는다는 것이다. (스레드는 프로세스 안에서 자원을 공유하므로 영향을 받는다.)
- 이런 독립적 구조를 가진 `프로세스 간의 통신`을 해야 하는 상황이 있을 것이고, 이를 가능하도록 해주는 것이 IPC 통신이다.
- 프로세스는 커널이 제공하는 IPC 설비를 이용해 프로세스 간 통신을 할 수 있다.
- IPC 설비 종류는 여러 가지가 있고, 필요에 따라 IPC 설비를 선택해서 사용해야 한다.

<br>

### IPC 종류

#### 1. (익명) PIPE

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile9.uf.tistory.com%2Fimage%2F99D729355B9725A83FFBE5" />

- 정의
  - 익명의 `PIPE`를 통해서 부모-자식 프로세스 간 통신처럼 통신할 프로세스를 명확히 알 수 있는 경우에 사용
- 구조
  - FIFO 구조
  - 생성된 `PIPE`에 대하여 Write 또는 Read만 가능
- 사용시기
  - 부모-자식 프로세스 간 통신할 때 사용
- 특징
  - `PIPE`는 두 개의 프로세스를 연결하는데 하나의 프로세스는 데이터를 쓰기만 하고, 다른 하나는 데이터를 읽기만 할 수 있다.
  - 한쪽 방향으로만 통신이 가능한 반이중(Half-Duplex) 통신이라고도 부른다.
  - 따라서 양쪽으로 모두 송/수신을 하고 싶으면 2개의 파이프를 만들어야 한다.
- 장점
  - 매우 간단하게 사용할 수 있다.
  - 단순한 데이터 흐름을 가질 땐 파이프를 사용하는 것이 효율적이다.
- 단점
  - 전이중 통신을 위해 2개를 만들어야 할 때는 구현이 복잡해지게 된다.

<br>

#### 2. Named PIPE(FIFO)

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile30.uf.tistory.com%2Fimage%2F998430355B9725A8137660" />

- 정의
  - 이름을 가진 `PIPE`를 통해서 프로세스들 간에 단방향 통신을 지원
  - 서로 다른 프로세스들이 `PIPE`의 이름만 알면 통신이 가능
- 구조
  - FIFO 구조
  - 생성된 `PIPE`에 대하여 Write 또는 Read만 가능
- 사용시기
  - 연관이 전혀 없는 프로세스 간에 통신을 할 때 사용
- 특징
  - `익명 PIPE`는 통신할 프로세스를 명확히 알 수 있는 경우에 사용한다. (부모-자식 프로세스 간 통신처럼)
  - `Named PIPE`는 전혀 모르는 상태의 프로세스들 사이 통신에 사용한다.
  - 즉, `익명 PIPE`의 확장된 상태로 부모 프로세스와 무관한 다른 프로세스도 통신이 가능한 것이다.
  - 하지만, `Named PIPE` 역시 읽기/쓰기가 동시에 불가능하다.
  - 따라서 전이중 통신(Full-Duplex)을 위해서는 익명 파이프처럼 2개를 만들어야 가능하다.

<br>

#### 3. Message Queue

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile4.uf.tistory.com%2Fimage%2F9936B1335B975B8105D210" />

- 정의
  - 메모리를 사용한 `PIPE`이다.
  - 구조체 기반으로 통신을 한다.
- 구조
  - FIFO 구조
  - msgtype에 따라 다른 구조체를 가져올 수 있다.
- 사용시기
  - 프로세스 간 다양한 통신을 할 때 사용
- 특징
  - 입출력 방식은 `Named PIPE`와 동일하다.
  - 차이점은 `Message Queue`는 파이프처럼 데이터의 흐름이 아니라 메모리 공간이다.
  - 사용할 데이터에 번호를 붙이면서 여러 프로세스가 동시에 데이터를 쉽게 다룰 수 있다.

<br>

#### 4. 공유 메모리 (Shared Memory)

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile28.uf.tistory.com%2Fimage%2F995C864E5B9766171D9786" />

- 정의
  - 시스템 상의 공유 메모리를 통해 통신
- 구조
  - 일정한 크기의 메모리를 프로세스 간에 공유하는 구조
  - 공유 메모리는 커널에서 관리
- 사용시기
  - 프로세스 간 Read, Write를 모두 필요로 할 때 사용
- 특징
  - 파이프, 메시지 큐가 통신을 이용한 설비라면, 공유 메모리는 데이터 자체를 공유하도록 지원하는 설비다.
  - 프로세스의 메모리 영역은 독립적으로 가지며 다른 프로세스가 접근하지 못하도록 반드시 보호되야한다. 하지만 다른 프로세스가 데이터를 사용하도록 해야하는 상황도 필요할 것이다. 파이프를 이용해 통신을 통해 데이터 전달도 가능하지만, 스레드처럼 메모리를 공유하도록 해준다면 더욱 편할 것이다.
  - 공유 메모리는 프로세스간 메모리 영역을 공유해서 사용할 수 있도록 허용해준다.
  - 프로세스가 공유 메모리 할당을 커널에 요청하면, 커널은 해당 프로세스에 메모리 공간을 할당해주고 이후 모든 프로세스는 해당 메모리 영역에 접근할 수 있게 된다.
  - 중개자(ex) `PIPE`) 없이 곧바로 메모리에 접근할 수 있어서 IPC 중에 가장 빠르게 작동한다.

<br>

#### 5. 메모리 맵 (Memory Map)

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile27.uf.tistory.com%2Fimage%2F9951304F5B9863F82D94DD" />

- 정의
  - 열린 파일을 프로세스의 메모리에 일정 부분 맵핑시켜서 공유하는 방식이다. (즉 공유 매개체가 파일+메모리)
- 사용시기
  - 주로 파일로 대용량 데이터를 공유해야 할 때 사용
  - FILE IO가 느릴 때 사용
  - 대부분 운영체제에서는 프로세스를 실행할 때 실행 파일의 각 세그먼트를 메모리에 맵핑하기 위해 `메모리 맵 파일`을 이용
- 특징
  - 공유 메모리처럼 메모리를 공유해준다.
  - 기본 파일 입출력 API에 비해서 저렴한 비용을 사용하여 파일의 내용에 접근할 수 있도록 해준다.
  - Write 시기에는 프로세스의 페이지가 메모리에서 내려갈 때만 Write 된다. 따라서, 메모리와 file sync가 안 맞을수도 있다.
- 장점
  - 직접적인 파일 입출력을 수행할 필요가 없다.
  - `메모리 맵 파일`을 사용하면 파일 내용이 메모리 주소에 맵핑되므로 파일을 모두 불러온 것처럼 메모리 주소를 이용하여 연산 작업을 할 수 있어 코드가 깔끔해지고 유지보수가 편해진다.
  - 운영체제에서 페이징 기법을 사용하여 파일의 내용을 관리하기 때문에 버퍼나 파일 처리를 위한 추가적인 자료 구조가 필요 없다.
- 단점
  - `메모리 맵 파일`은 파일의 크기를 바꿀 수 없으며 `메모리 맵 파일`을 사용하기 이전 또는 이후에만 파일의 크기를 바꿀 수 있다.

<br>

#### 6. 소켓 (Socket)

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile22.uf.tistory.com%2Fimage%2F99F640335B986BCD2DE4BC" />

- 정의
  - 네트워크 소켓 통신을 사용한 데이터 공유
- 구조
  - 네트워크 소켓을 이용하여 클라이언트-서버 구조로 데이터 통신
- 사용시기
  - 원격에서 프로세스 간 데이터를 공유할 때 사용
- 특징
  - 네트워크 프로그래밍이 가능해야 한다.
  - 데이터 세그먼트 처리를 잘 해야 한다.

<br>
<br>

### 요약

| IPC 종류       | PIPE                                 | Named PIPE                     | Mesage Queue                   | Shared Memory                  | Memory Map                     | Socket                       |
| -------------- | ------------------------------------ | ------------------------------ | ------------------------------ | ------------------------------ | ------------------------------ | ---------------------------- |
| 사용시기       | 부모 자식 프로세스 간 단방향 통신 시 | 다른 프로세스와 단방향 통신 시 | 다른 프로세스와 단방향 통신 시 | 다른 프로세스와 양방향 통신 시 | 다른 프로세스와 양방향 통신 시 | 다른 시스템간 양방향 통신 시 |
| 파일           | 파일                                 | 메모리                         | 메모리                         | 메모리                         | 파일+메모리                    | 소켓                         |
| 통신 단위      | Stream                               | Stream                         | 구조체                         | 구조체                         | 페이지                         | Stream                       |
| 통신 방향      | 단방향                               | 단방향                         | 단방향                         | 양방향                         | 양방향                         | 양방향                       |
| 통신 가능 범위 | 동일 시스템                          | 동일 시스템                    | 동일 시스템                    | 동일 시스템                    | 동일 시스템                    | 동일+외부 시스템             |

<br>
<br>

### reference

https://gyoogle.dev/blog/computer-science/operating-system/IPC.html IPC의 종류
https://doitnow-man.tistory.com/110 IPC의 종류
