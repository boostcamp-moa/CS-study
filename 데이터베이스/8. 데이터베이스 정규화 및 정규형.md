# 데이터베이스 정규화 및 정규형

### 1. 데이터베이스 정규화의 개념 

관계형 데이터베이스에서 중복을 최소화하고 무결성을 향상시키는 등 여러 목적을 달성하기 위해 관계형 데이터베이스를 정규화된 형태로 구조화하는 작업이다. 

좀 더 구체적으로는 불만족스러운 **나쁜 릴레이션**의 애트리뷰트들을 나누어서 **최소한의 크기인 좋은 릴레이션**으로 분해하는 작업을 말한다. 정규화 과정을 거치게 되면 정규형을 만족하게 된다. 

> `정규형`이란 특정 조건을 만족하는 릴레이션의 스키마의 형태를 말한다.
>
> 제 1정규형, 제 2정규형, 제 3정규형, BC(Boyce-Codd) 정규형, 제 4정규형, 제 5정규형이 있는데, 대체로 실무에서는 제 3정규형을 만드는 제 3정규화까지의 과정을 거친다고 한다.

<br>
 
#### '나쁜 릴레이션'은 어떻게 파악하는가?

엔티티를 구성하고 있는 애트리뷰트 간에 `함수적 종속성(Functional Dependency)`을 판단한다. 판단된 함수적 종속성은 **좋은 릴레이션** 설계의 정형적 기준으로 사용된다. 즉, 각각의 정규형마다 어떠한 함수적 종속성을 만족하는지에 따라 정규형이 정의되고, 그 정규형을 만족하지 못하는 정규형을 나쁜 릴레이션으로 파악한다.

<br>

#### 함수적 종속성이란 무엇인가?

함수적 종속성이란 애트리뷰트 데이터들의 의미와 애트리뷰트들 간의 상호 관계로부터 유도되는 제약조건의 일종이다. 쉽게 말해, X의 값에 따라 Y값이 결정될 때 `X -> Y`로 표현되는데, 이러한 표현을 보고 "Y는 X에 대해 함수적으로 종속되었다"고 한다.

예를 들어 학번을 알면 이름을 알 수 있는데, 이 경우엔 학번이 X가 되고 이름이 Y가 된다. 이를 두고 다양한 표현이 가능한데, 다음과 같다.

- X를 **결정자**라고 부르고, Y를 **종속자**라고 부름
- X가 바뀌었을 때, Y는 바뀌어야만 함

함수적 종속을 설명할 때 X의 값이 2개 이상의 요소일 때, **완전 함수적 종속**과 **부분 함수적 종속**으로 구분될 수 있다.

- 완전 함수적 종속 : `{X1, X2} -> Y`일 때, X1와 X2 모두가 Y의 값을 결정할 때
- 부분 함수적 종속 : `{X1, X2} -> Y`일 때, X1 혹은 X2 중 일부분만 Y의 값을 결정할 때

예를 들어 다음과 같은 테이블이 있다고 가정하자.

![](https://i.imgur.com/WSy0UCM.png)

위 테이블에서 `Model`과 `Manufacturer`는 따로가 기본키가 될 수 없다. 오직 복합키인 `{Model, Manufacturer}`만이 후보키가 될 수 있다.
여기서 `Model full name` 속성의 도메인은 `Model`과 `Manufacturer`를 합쳐서 만든 도메인이므로, `{Model, Manufacturer} -> Model Full Name`라고 할 수 있다. 

하지만 `{Model, Manufacturer} -> Manufacturer Country`에서 `Model`과 `Manufacturer Country`는 아무런 연관 관계가 없기 때문에, `Manufacturer Country`는 `Manufacturer`와만 종속관계에 있게 되고 이를 **부분 함수 종속**이라고 하게 되는 것이다. 

아래의 그림을 보면 쉽게 이해할 수 있다.

![](https://i.imgur.com/LV06OxL.png)

<br>

아울러, **이행적 종속**이라는 개념도 알고 있어야 한다.

- 이행적 종속이란, `X -> Y`이고 `Y -> Z`이면, `X -> Z`가 성립하는 경우를 의미

<br>

### 2. 데이터베이스 정규화의 목적

- 불필요한 데이터 제거 및 데이터 중복 최소화
- 데이터베이스 구조 확장 시 다시 디자인해야 하는 경우를 최소화
- 무결성 제약조건의 시행을 간단하게 하기 위함
- 각종 **[이상 현상(Anomaly)](https://gyoogle.dev/blog/computer-science/data-base/Anomaly.html)**을 방지하기 하기 위함

<br>

### 3. 정규화의 대상

CRUD가 빈번히 일어나는 데이터베이스

<br>

### 4. 정규형의 종류

#### (1) 제 1정규형(First Normal Form, 1NF)

제 1정규화를 진행할 경우, 모든 릴레이션은 아래 조건들을 만족

1. 릴레이션에 속한 모든 도메인은 **원자값**만으로 구성

2. 모든 애트리뷰트에 **반복되는 그룹**이 발생하지 않음

3. **기본키**를 사용하여 각 튜플을 고유하게 식별할 수 있어야 함

<br>

- 첫 번째 조건을 만족하지 않는 릴레이션

  ![](https://i.imgur.com/cDL6ngy.png)

- 첫 번째 조건을 만족했지만, 두 번째 조건을 만족하지 못한 릴레이션

  ![](https://i.imgur.com/E2kvxX2.png)

- 앞선 두 조 건을 만족했지만, 세 번째 조건을 만족하지 못한 릴레이션

  ![](https://i.imgur.com/7XACX23.png)

- 제 1정규형을 만족시키기 위해 두 릴레이션으로 나눈 모습

  ![](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20210104024152484.png)

<br>

### (2) 제 2정규형(Second Normal Form, 2NF)

제 2정규화를 진행할 경우, 모든 릴레이션은 아래 조건을 만족

- 릴레이션의 모든 비주요 애트리뷰트들이 주요 애트리뷰트에 대해 완전 함수적 종속
  (즉, 부분 함수적 종속을 모두 제거)

<br>

(부분 함수적 종속에 대한 설명은 위에 많이 되어 있으므로 생략)

- 2 정규화의 대상 릴레이션 - 부분 함수적 종속이 존재

  ![](https://i.imgur.com/DipbEam.png)

  여기서 부분 함수적 종속을 제거해야 한다. 위에서 설명했던 부분 함수적 종속을 제거한 모습은 다음과 같다.
  
  ![](https://i.imgur.com/l2wdqaQ.png)

- 제 2정규형을 만족시키기 위해 두 릴레이션으로 나눈 모습

  ![](https://i.imgur.com/WsuvA0A.png)

<br>

### (3) 제 3정규형(Third Normal Form, 3NF)

제 3정규화를 진행할 경우, 모든 릴레이션은 아래 조건들을 만족

1. 릴레이션이 제 2정규화 되었음
2. 릴레이션의 어떠한 비주요 애트리뷰트도 기본키에 대해서 **이행적으로 종속되지 않음**
   (즉, 비주요 애트리뷰트가 비주요 애트리뷰트에 의해 종속되는 경우가 없는 릴레이션 형태)

<br>

- 두 번째 조건을 만족시키지 못하는 예시

  ![](https://i.imgur.com/bNN2yWZ.png)

  위 릴레이션에서 `{Tournament, Year}` 가 후보키가 된다. 하지만 `Winner's date of birth`는 기본키가 아닌 속성 `Winner`를 거쳐 `{Tournament, Year}`에 의존하고 있는 것을 알 수 있다. 

  `Winner's date of birth`가 `Winner`에 의존하게 되면 동일한 사람이 다른 튜플에서 다른 생년월일로 표시되는 것을 막을 수 없다. 즉, 테이블이 논리적으로 불일치가 발생하는 취약점이 발생할 수 있다. 따라서 테이블을 아래와 같이 둘로 나누어 주자.

- 제 3정규형을 만족시키기 위해 두 릴레이션으로 나눈 모습

  ![](https://i.imgur.com/TFg5fXb.png)



---

레퍼런스

1. [정규형의 종류](http://wiki.gurubee.net/pages/viewpage.action?pageId=28115399)

2. [데이터베이스 정규화 개념 설명 및 예제](https://wkdtjsgur100.github.io/database-normalization/) - 설명이 너무 잘 되어 있어서 글 내용을 거의 복붙해온 정도입니다. 다른 레퍼런스들과 크로스 체크 완료했습니다.

3. [위키백과 - First normal form](https://en.wikipedia.org/wiki/First_normal_form)
4. [위키백과 - Second normal form](https://en.wikipedia.org/wiki/Second_normal_form)

5. [위키백과 - Third normal form](https://en.wikipedia.org/wiki/Third_normal_form)

