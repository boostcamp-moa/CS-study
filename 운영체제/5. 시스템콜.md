레퍼런스 

https://duksoo.tistory.com/entry/System-call-%EB%93%B1%EB%A1%9D-%EC%88%9C%EC%84%9C

![](https://i.imgur.com/pFrG3vx.png)

운영체제는 "유저 모드" 와 "커널 모드" 2가지 모드가 존재한다. 이 둘의 차이점은 <strong>특권 명령</strong>을 수행할 수 있는지로 여부가 나뉜다.

이 특권명령과 일반명령은 다시 하드웨어에 직접 접근이 가능한가 아닌가로 나뉘게 된다.

유저 모드는 I/O 장치와 하드웨어 장치에 집적 접근이 불가능 하지만, 특권 명령을 사용하는 커널 모드에서는 직접 접근이 가능하다.

<strong>시스템 콜</strong>은 유저 모드의 어플리케이션이 커널 모드의 기능을 사용할 수 있도록 해주는 인터페이스이다.

커널은 내부적으로 처리할 시스템 콜 함수들을 고유 번호로 할당해 저장해놓고 이를 호출하여 사용하는 방법으로 사용된다.

## 시스템 콜 종류

1. 프로세스를 제어하는 부류 (fork,wait,exec...)
2. 파일 I/O와 관련된 부류
3. 하드웨어에 접근하는 부류
4. 통신과 관련된 부류 (IPC,Network)

## 시스템 콜 처리 과정

![](https://i.imgur.com/pVBq5dp.png)


1. 시스템 콜이 호출된다. (fork 함수 호출)
2. C 라이브러리의 fork 함수에서 fork 시스템 콜의 고유 번호인 2를 eax 레지스터에 저장한다.
3. 이후 0x80 인터럽트를 발생시킨다.
4. 커널은 IDT에서 0x80번의 시스템 콜을 찾아 수행한다. (여기서 부터 제어의 흐름이 커널로 넘어가게 된다.) 현재 프로세스의 Context를 커널 스택에 저장한다.
5. system_call 함수에서는 호출된 시스템콜 번호을 바탕으로 sys_call_table에서 실행할 함수를 찾아 호출한다.
6. 함수가 종료되면 커널스택에서 저장해둔 Context을 꺼내온다.
7. 유저 모드로 전환된다
8. 다시 실행된다.

### 용어

IDT(Interrupt Descriptor Table): 프로세서에서 인터럽트,exception이 발생했을때 처리할 핸들러들의 주소를 모아놓은 테이블이다. IDT에 서비스 루틴 함수 주소를 저장하고 사용한다.