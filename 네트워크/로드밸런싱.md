# 로드 밸런싱 (Load Balancing)

> 둘 이상의 CPU 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것

<br>

## 로드 밸런싱의 등장 배경

요즘 시대에는 웹사이트에 접속하는 인원이 급격히 늘어나게 되었다.

따라서 이 사람들에 대해 모든 트래픽을 감당하기엔 1대의 서버로는 부족하다.
대응 방안으로 하드웨어의 성능을 올리거나(`Scale-up`) 여러대의 서버가 나눠서 일하도록 만드는 것(`Scale-out`)이 있다.

![](http://library.gabia.com/wp-content/uploads/2016/03/hosting-160324-002.jpg)

- 스케일 업

  - 서버에 CPU나 RAM 등을 추가하거나 고성능의 부품, 서버로 교환하는 방법
  - ex) `1`의 처리 능력을 가진 서버 한 대를 `5`의 처리 능력을 가진 서버로 업그레이드시키는 것
  - 서버 한 대에 모든 부하가 집중되므로 장애 시 영향을 크게 받을 수 있는 위험성 존재
  - 한 대의 서버에서 모든 데이터를 처리하므로 데이터 갱신이 빈번하게 일어나는 `데이터베이스 서버`에 적합한 방식

- 스케일 아웃
  - 서버를 여러 대 추가하여 시스템을 확장하는 방법
  - ex) `1`의 처리 능력을 가진 서버에 동일한 서버 `4`대를 더 추가하여, 총 `5`의 처리 능력을 만드는 것
  - 서버가 여러 대가 되기 때문에 각 서버에 걸리는 부하를 균등하게 해주는 `로드밸런싱`이 필수적으로 동반
  - 서버 한 대가 장애로 다운되더라도 다른 서버로 서비스 제공이 가능하다는 장점
  - 모든 서버가 동일한 데이터를 가지고 있어야 하므로, 데이터 변화가 적은 `웹 서버`에 적합한 방식

> 하드웨어 향상 비용이 더욱 비싸기도 하고, 서버가 여러대면 무중단 서비스를 제공하는 환경 구성이 용이하므로 `Scale-out`이 효과적이다. 이때 여러 서버에게 균등하게 트래픽을 분산시켜주는 것이 바로 **로드 밸런싱**이다.

![](https://camo.githubusercontent.com/b59f02d63a1372b35abffa94e241b9b8d27447f3/68747470733a2f2f7777772e6564756361746976652e696f2f6170692f636f6c6c656374696f6e2f353636383633393130313431393532302f353634393035303232353334343531322f706167652f353734373937363230373037333238302f696d6167652f353639363435393134383039393538342e706e67)

`로드 밸런싱`은 분산식 웹 서비스로, 여러 서버에 부하(Load)를 나누어주는 역할을 한다. `Load Balancer`를 클라이언트와 서버 사이에 두고, 부하가 일어나지 않도록 여러 서버에 분산시켜주는 방식이다. 서비스를 운영하는 사이트의 규모에 따라 웹 서버를 추가로 증설하면서 로드 밸런서로 관리해주면 웹 서버의 부하를 해결할 수 있다.

<br>

## 로드 밸런서가 서버를 선택하는 방식

- `라운드 로빈(Round Robin)`
  - CPU 스케줄링의 라운드 로빈 방식 활용
- `Least Connections`
  - 연결 개수가 가장 적은 서버 선택
  - 트래픽으로 인해 세션이 길어지는 경우 권장
- `Source`
  - 사용자 IP를 해싱하여 분배
  - 특정 사용자가 항상 같은 서버로 연결되는 것 보장

<br>

## 로드 밸런서 장애 대비

> 서버를 분배하는 로드 밸런서에 문제가 생길 수 있기 때문에 로드 밸런서를 이중화하여 대비한다.

`Active` 상태와 `Passive` 상태로 나뉜다.
![](https://nesoy.github.io/assets/posts/20180602/7.png)

### 장애가 났을 경우

![](https://nesoy.github.io/assets/posts/20180602/8.gif)

- 이중화된 `Load Balancer`들은 서로 `Health Check`를 한다.
- `Main Load Balancer`가 동작하지 않으면 가상IP(VIP, Virtual IP)는 `여분의 Load Balancer`로 변경된다.
- 여분의 Load Balancer로 운영하게 됩니다.

<br>
<br>

### reference

- https://library.gabia.com/contents/infrahosting/1222 스케일 업과 스케일 아웃
- https://nesoy.github.io/articles/2018-06/Load-Balancer 로드밸런서
